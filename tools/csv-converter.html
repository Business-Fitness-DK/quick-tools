<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSV Converter</title>
  <link rel="icon" type="image/png" href="../assets/images/favicon.png">
  <link rel="stylesheet" href="../assets/css/brand.css">
  <style>
    .tool-container {
      max-width: 700px;
      margin: 0 auto;
    }

    .upload-section {
      margin-bottom: var(--spacing-xl);
    }

    .file-upload-area {
      min-height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .upload-text {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-md);
    }

    .file-info {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
      padding: var(--spacing-md);
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      margin-top: var(--spacing-md);
      font-size: 0.875rem;
    }

    .file-name {
      font-weight: 500;
      color: var(--text-primary);
    }

    .file-size {
      color: var(--text-tertiary);
      font-size: 0.8125rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin-bottom: var(--spacing-lg);
    }

    .stat-card {
      padding: var(--spacing-md);
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 0.25rem;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 500;
      color: var(--text-primary);
    }

    .preview-section {
      margin-top: var(--spacing-xl);
    }

    .preview-label {
      font-size: 0.75rem;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--spacing-sm);
    }

    .preview-box {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      padding: var(--spacing-md);
      max-height: 200px;
      overflow: auto;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Courier New', monospace;
      font-size: 0.8125rem;
      line-height: 1.6;
      white-space: pre;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-lg);
    }

    .actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    .actions .btn {
      flex: 1;
      min-width: 140px;
    }

    .section-title {
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: var(--spacing-md);
      color: var(--text-primary);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <a href="../index.html" class="logo">
        <img src="../assets/images/logo.png" alt="Logo">
        <span class="logo-text">Quick Tools from Business & Fitness</span>
      </a>
      <a href="../index.html" class="back-link">Back</a>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <div class="tool-container">
      <h1 class="page-title">CSV Converter</h1>
      <p class="page-subtitle">Convert semicolon-separated to comma-separated format</p>

      <!-- Upload Section -->
      <div class="upload-section" id="uploadSection">
        <div class="file-upload-area" id="dropZone">
          <div class="file-upload-icon">↑</div>
          <p class="upload-text">Drop CSV file or click to browse</p>
          <input type="file" id="fileInput" accept=".csv,.txt" style="display: none;">
          <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
            Choose File
          </button>
        </div>
      </div>

      <!-- Success Message -->
      <div id="successSection" class="hidden" style="text-align: center;">
        <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">✓</div>
        <p style="font-size: 1.125rem; font-weight: 500; color: var(--text-primary); margin-bottom: var(--spacing-sm);">File converted successfully</p>
        <p style="font-size: 0.875rem; color: var(--text-secondary); margin-bottom: var(--spacing-xl);">Your CSV file has been converted to comma-separated format</p>

        <div class="actions" style="justify-content: center;">
          <button class="btn btn-primary" id="downloadBtn">Download Converted CSV</button>
          <button class="btn btn-secondary" id="resetBtn">Convert Another File</button>
        </div>
      </div>

      <!-- Alert Area -->
      <div id="alertArea"></div>

    </div>
  </main>

  <script>
    let originalContent = '';
    let convertedContent = '';
    let currentFileName = '';

    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const uploadSection = document.getElementById('uploadSection');
    const successSection = document.getElementById('successSection');
    const downloadBtn = document.getElementById('downloadBtn');
    const resetBtn = document.getElementById('resetBtn');
    const alertArea = document.getElementById('alertArea');

    // File Upload
    dropZone.addEventListener('click', (e) => {
      if (e.target === dropZone || e.target.closest('.file-upload-icon') || e.target.closest('.upload-text')) {
        fileInput.click();
      }
    });

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('drag-over');
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
    });

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) handleFile(file);
    });

    function handleFile(file) {
      if (!file.name.endsWith('.csv') && !file.name.endsWith('.txt')) {
        showAlert('Please upload a CSV or TXT file', 'error');
        return;
      }

      currentFileName = file.name;
      const reader = new FileReader();

      reader.onload = (e) => {
        originalContent = e.target.result;
        processFile();
      };

      reader.onerror = () => {
        showAlert('Error reading file', 'error');
      };

      reader.readAsText(file);
    }

    function processFile() {
      try {
        const firstLine = originalContent.split('\n')[0];
        const semicolonCount = (firstLine.match(/;/g) || []).length;
        const commaCount = (firstLine.match(/,/g) || []).length;

        let needsConversion = semicolonCount > commaCount;

        if (needsConversion) {
          convertedContent = originalContent.replace(/;/g, ',');
        } else {
          convertedContent = originalContent;
          showAlert('File is already comma-separated, no conversion needed', 'success');
        }

        // Hide upload section, show success section
        uploadSection.classList.add('hidden');
        successSection.classList.remove('hidden');

      } catch (error) {
        showAlert('Error processing file: ' + error.message, 'error');
      }
    }

    downloadBtn.addEventListener('click', () => {
      const blob = new Blob([convertedContent], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = currentFileName.replace('.csv', '_converted.csv').replace('.txt', '_converted.csv');
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showAlert('Downloaded successfully!', 'success');
    });

    resetBtn.addEventListener('click', () => {
      originalContent = '';
      convertedContent = '';
      currentFileName = '';
      fileInput.value = '';
      uploadSection.classList.remove('hidden');
      successSection.classList.add('hidden');
      alertArea.innerHTML = '';
    });

    function showAlert(message, type) {
      const alertClass = type === 'success' ? 'alert-success' : 'alert-error';
      alertArea.innerHTML = `<div class="alert ${alertClass}">${message}</div>`;
      setTimeout(() => {
        alertArea.innerHTML = '';
      }, 3000);
    }
  </script>

</body>
</html>
